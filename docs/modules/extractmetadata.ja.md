# メタデータの抽出

[メタデータ抽出モジュール](https://omeka.org/s/modules/ExtractMetadata){target=_blank}は、サイト管理者がメディアファイルから埋め込まれたメタデータを抽出できるようにします。

このモジュールは各メディアページに新たな「メタデータの抽出」タブを追加し、ファイルに埋め込まれたメタデータを手動で抽出することができます。また、「メタデータの抽出」フィールドを一括編集ページに追加します。有効にすると、新しくアップロードされたファイルに自動的に作用します。

良いワークフローは、モジュールのインストールと設定を行い、データベース内の既存ファイルからメタデータを一括で抽出し、選択したメディアメタデータフィールドにマッピングした後、将来的にはモジュールがファイルからメタデータを自動的に抽出し続けることです。

## モジュールの設定

モジュールを設定する際には以下が可能です：

- 抽出器の表示、有効/無効切り替え：ExifTool、Tika、Exif、getID3（下記参照）を含む4種類の抽出器から選べます。
- マッパーの表示、有効/無効切り替え：マッパーを無効にするか、JSON Pointerを有効に選択できます。
- JSON Pointerマッパーが有効になっている場合、メタデータクロスウォークを設定します。JSONポインタマッパーを使用する場合は、メタデータクロスウォークを定義する必要があります。
    1. 「マップ追加 +」ボタンをクリックします。
    1. ドロップダウンメニューからリソース、抽出器、プロパティを選択します。
    1. [IETF標準](https://datatracker.ietf.org/doc/html/rfc6901){target=_blank}に定義されたJSONポインターを使用してポインターを提供します。
    1. このポインターを介してメタデータ値を置き換えたい場合は、これらのフィールドの右側にあるチェックボックスを選択してください。

モジュールの設定が完了したら、画面の右上にある「送信」ボタンをクリックしてください。

![JSON Pointerクロスウォークと送信ボタンを示すティール色の矢印が示されたメタデータ抽出モジュールの設定ビュー](../modules/modulesfiles/extractmetadata_config.png)

## メディアの追加

モジュールが設定され、抽出器が有効になると、アイテムに追加する際やアセットとして追加する際に、各ファイルに対して自動的に以下のことを行います：

- 有効な抽出器を使用してファイルからメタデータを抽出
- メディアと並んでメタデータを保存
- マッパーが有効になっている場合はメタデータをメディア値にマッピング

「メタデータの抽出」タブのメディアページで抽出されたメタデータを確認できます。

## メディアとアイテムの編集

ユーザーはアイテムに添付されたメディアメタデータを、個々のアイテムを直接編集するか、一括編集機能を使用して編集することができます。

### アイテムの編集
メディア/アイテムの編集時には、「メタデータの抽出」タブを通じてアクセスできるいくつかのアクションを選択できます。ドロップダウンメニューから4つのオプションを選択します。

- メタデータの更新：（再）ファイルからメタデータを抽出
- メタデータを更新してマッピング：（再）ファイルからメタデータを抽出し、リソース値にマッピング
- メタデータのマッピング：抽出されたメタデータをリソース値にマッピング
- メタデータの削除：抽出されたメタデータを削除する。

![メタデータの抽出タブがアクティブであり、アクションのドロップダウンメニューが開いているアイテム編集ビュー](../modules/modulesfiles/extractmetadata_actions.png)

選択したアクションを実行するためには、画面右上の「保存」ボタンを必ずクリックしてください。

### 一括編集

アイテムの閲覧画面から、一括編集を行いたいアイテムを選択します。一括編集ページからは、「メタデータの抽出」ドロップダウンメニューの4つのアクションオプションを選択できます。これにより、一括編集に含めることを選択したすべてのアイテムに対してアクションが実行されます。

![メタデータ抽出のドロップダウンが開かれた一括編集ビュー](../modules/modulesfiles/extractmetadata_batchedit.png)

## 抽出器

抽出器はファイルからメタデータを抽出します。抽出器はモジュール設定ページで有効にする必要があります。このモジュールには4つの抽出器が含まれていますが、必要に応じてさらに追加することができます。これらのユーティリティーに対するサーバーのサポートは既にあるかもしれませんが、問題が生じている場合は、依存関係がインストールされているかどうかを再確認してください。

### ExifTool

多種多様なメタデータを多様なファイルから抽出するために使用します。[ExifTool](https://exiftool.org/){target=_blank}コマンドラインアプリケーションが必要です。

### Exif

主にJPEGやTIFFファイルで見られるEXIFメタデータを抽出するために使用します。PHPの[exif](https://www.php.net/manual/en/book.exif.php){target=_blank}拡張機能が必要です。

### getID3

多種多様なメタデータを多様なファイルから抽出するために使用します。このモジュールに付随する[getID3](https://github.com/JamesHeinrich/getID3){target=_blank} PHPライブラリを使用します。
 
### Tika

多種多様なメタデータを多様なファイルから抽出するために使用します。[Apache Tika](https://tika.apache.org/){target=_blank}コンテンツ分析ツールキットが必要です。Javaがインストールされている必要があり、`config/module.config.php`の`[extract_metadata_extractor_config][tika][jar_path]`に`tika-app-*.jar`ファイルのパスを設定する必要があります。

## マッパー

マッパーは抽出されたメタデータをリソース値にマッピングします。マッパーはモジュール設定ページで有効にする必要があります。このモジュールには1つのマッパーが含まれています。他のマッパーをこのモジュールで使用するためのベストプラクティスは、モジュールコードをフォークすることです。詳細については[開発者向けドキュメント](https://omeka.org/s/docs/developer/modules/){target=_blank}を参照してください。

### JSONポインター

[JSONポインター](https://datatracker.ietf.org/doc/html/rfc6901){target=_blank}を使用して、抽出されたメタデータをメディアメタデータプロパティにマッピングできます。モジュール設定ページの「JSON Pointerクロスウォーク」タブで独自のメタデータクロスウォークを定義する必要があります。

最初にいくつかのファイルからメタデータを抽出して、ポイントすることができる情報を確認し、それらを最も適切にマッピングするオプションをテストすることをお勧めします。

一般的な例として、JPEGファイルの作成日をダブリンコアの「Date Created」プロパティにマッピングします。ポインターはExifメタデータの出力で`DateTimeOriginal`値を指しますが、メディアアイテムを見て「メタデータの抽出」タブを見れば確認できます。

以下のようにマッパーを設定します：
+ リソース：[メディアまたはアイテム]
+ 抽出器：「Exif」
+ ポインター：`/EXIF/DateTimeOriginal`
+ プロパティ：「ダブリンコア : Date Created」
+ 値の置き換え：[チェックありまたはなし]。

![JSON Pointerクロスウォークと送信ボタンを示すティール色の矢印が示されたメタデータ抽出モジュールの設定ビュー](../modules/modulesfiles/extractmetadata_config.png)

このマップを保存した後、1つのファイルまたは一括で「メタデータのマッピング」アクションを実行し、JPEGファイルに`DateTimeOriginal`が含まれている場合、メディアは「Date Created」の値を持つようになります。