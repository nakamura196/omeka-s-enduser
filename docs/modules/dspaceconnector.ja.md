# DSpaceコネクター

[DSpaceコネクターモジュール](https://omeka.org/s/modules/DspaceConnector){target=_blank} は、Omeka Sインスタンスを[DSpaceリポジトリー](https://duraspace.org/dspace/){target=_blank}に接続し、そのリポジトリからアイテムをインポートすることを可能にします。情報のインポートに加えて、Omeka Sのアイテムには元のアイテムへのリンクが含まれます。これにより、必要に応じて[ソースからの情報を更新する](#imported-resources-の更新)ことができます。

DSpaceコネクタはDSpaceのバージョン5.6以上でのみ動作し、DSpace 7.xを含んでいます。このコネクターはDSpace APIとサイトごとの設定に依存しています。

## APIのチェック

まずは、目的のDSpaceインスタンスが公開アクセス可能であるかをテストしたいかもしれません。これを行うには、ブラウザを使用し、APIエンドポイントをテストします：

- DSpaceリポジトリーのURLをとり、`/rest/collections`を追加します（7.0より前のバージョンの場合）
- DSpaceリポジトリーのURLをとり、`/server/api/core/collections/`を追加します（7.x以降のバージョンの場合）。

ブラウザでページをロードしたときにエラーが発生した場合、APIはインポート可能ではありません。

## データのインポート

「DSpaceコネクター」セクションに移動します。これはモジュールの下にあります。

![DSpaceコネクターのフィールドオプションのスクリーンショット](../modules/modulesfiles/dspace_import.png)

最初のフォームに以下の情報を入力します：

* **DSpaceサイトURL** - `http://`を含む完全なURL
* **エンドポイント** - API用（デフォルトでは「rest」ですが、DSpaceインスタンスで変更することができます）
* **リミット** - 一度のリクエストで取得する最大の結果数
* **テストインポート** - テストのみで、次の画面の選択したコレクションから限定数の結果をインポートしたい場合にだけこのオプションを使用します。テストや微調整に便利です。

DSpaceのバージョンが7未満の場合は、おそらく「rest」をエンドポイントとして使用します。DSpaceのバージョンが7以上の場合は、おそらく「server/api」をエンドポイントとして使用します。これは手動で入力する必要があります。

「コレクションとコミュニティの取得」ボタンをクリックします。上記の情報が正しく入力されていれば、DSpaceコネクタインポートオプションのページに進むことができます。ここには「基本的なインポート設定」と「コレクション」のタブがあります。

### 基本的なインポート設定
このタブには5つのオプションがあります：

* **Omeka Sへのファイルのインポート**: メタデータに加えてファイルをインポートするには、このチェックボックスをクリックします。
* **アイテムセット**: インポートされるアイテムを追加するアイテムセットをドロップダウンから選択するか、インポートされたDSpaceコレクションにちなんで新しいアイテムセットを作成します。
* **サイト**: インポートされたアイテムを指定したサイトまたはサイトに追加します。グローバルおよびユーザー固有のデフォルトサイトがここで事前選択されます。
* **無視するフィールド**: インポート時に無視するDSpaceメタデータフィールド。カンマで区切ります。
* **コメント**: インポートバッチに添付するコメント。これは「過去のDSpaceインポート」ページに表示されます。

![基本的なインポート設定、何も入力されておらず、チェックボックスもチェックされていない](../modules/modulesfiles/dspace_importset.png)

### コレクション
このタブにはDSpaceリポジトリーのコレクションリストが表示され、所属するコミュニティ別にまとめられます。一度に1つのコレクション、またはDSpaceリポジトリ全体をインポートすることができます。

単一のコレクションをインポートするには、その名前の左にある「インポート」ボタンをクリックします。これによりインポートが自動的に開始されます。

![mars.gmu.eduのDSpaceリポジトリからの最初のいくつかのコレクション](../modules/modulesfiles/dspace_coll.png)

リポジトリ全体をインポートするには、フォームの上部にある「リポジトリ全体をインポート」をクリックします。

!!! 注意
	アイテムの多いDSpaceリポジトリ全体をインポートする（5,000以上）と、サーバがリクエストで氾濫して失敗することが予想されます。コレクションごとにインポートすることを検討してください。それでも一度に大量のリポジトリ全体をインポートしたい場合は、以下が役立つかもしれません：

* 最初の「インポート設定」メニューで、**リミット**を小さい数、例えば50や25に設定します。
* 最初の「インポート設定」メニューで**テストインポート**のボックスをチェックしてインポートをテストします。
* 夜間やDSpaceサーバのトラフィックが少ないと思われる時にインポートを実行してください。
* インポートの各レコード間で[ `sleep()` 関数](https://www.w3schools.com/php/func_misc_sleep.asp){target=_blank}を一時的に挿入して、プロセスをわずかに遅らせることを検討してください（本番環境ではお勧めしません）。

インポートの状況は「DSpaceコネクタ過去のインポート」タブや、管理ダッシュボードの[ジョブ](../admin/jobs.md)ページで追跡できます。

!!! 注意
	ジョブが始まって完了しないことがありますか？システムが背景プロセスを実行してアイテムを作成できるように、[PHPのパスを設定する](../configuration.md#php-path)必要があるかもしれません。

## インポートのレビュー

「過去のDSpaceインポート」ページには、過去のDSpaceインポートのテーブルが表示されます。**元に戻す**のチェックボックスオプション、**再実行**のチェックボックスオプション、インポートの**ジョブID**、リポジトリの**Dspaceコレクションリンク**（見つかった場合はコレクション名として表示されます）、インポート中に行われた**コメント**、高度な検索結果へのリンクを含むインポートされた**アイテム**の数、インポートの**日付**、インポートの**状態**、そしてインポートを開始した**所有者**、またはユーザーがいます。

![異なるコレクションがインポートされ、2つの完了したインポートと1つのエラーを含む過去のインポートのテーブル](../modules/modulesfiles/dspace_past.png)

DSpaceのアイテムは、ソースで認識されたメタデータフィールド（`dc.title`や`dc.description.abstract`など）でインポートされ、`bibo:uri`を使用してソースのアイテムの`dc.identifier.uri`として与えられたURIを読み込みます。これは公開アイテムページ上でクリック可能なリンクとして表示され、ユーザーが元のDSpaceリポジトリでアイテムのソースを確認できるようになります。フィールドが1つ以上の言語タグを持っている場合、Omekaにインポートされたフィールドもその言語タグを使用します。

## imported resources の更新

DSpaceコネクターを使用して作成されたリソースを更新するには、「再実行」をチェックし、「送信」をクリックするだけです。リソースは再度インポートされるのではなく、更新されます。これにより、DSpaceとOmeka Sのインストール間でデータを同期するためにコネクターを使用することができます。

## インポートの取り消し

「過去のDSpaceインポート」ページから過去のインポートを見ることができます。完了したインポートを取り消し、関連するすべてのアイテムを削除するには、元に戻したい各インポートのボックスをチェックし、「送信」ボタンをクリックします。