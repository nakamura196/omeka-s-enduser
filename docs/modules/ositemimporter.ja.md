# Omeka S アイテムインポーター

[Omeka S アイテムインポーターモジュール](https://omeka.org/s/modules/Osii){target=_blank} は、Omeka Sのインストールから別のOmeka Sのインストールへアイテムをインポートすることができます。一つのインストールから別のインストールへデータを転送する際には、データが失われる可能性がありますが、受け取るインストールのユーザーが注意深く計画と準備を行えば、それを防ぐことができます。

## インポートの準備をする

データ損失を最小限に抑えるため、ローカルのインストールは提供側のインストールからデータを受け入れられるように慎重に準備する必要があります。できるだけ、受信側インストールの管理者は、リモートインストールのデータモデルを再現するように努めるべきです。そのために、管理者は以下のことを行うべきです：

- リモートインストールのアイテムで使用されているリンクデータ[語彙](../content/vocabularies.md)をインポートする。
- リモートインストールのアイテムの値として使用されるデータタイプを制御する[モジュールをインストールして設定する](../modules/index.md)。例えば：
     - [Custom Vocab](../modules/customvocab.md)：このモジュールをインストールするだけでなく、リモートインストールで使用されているカスタム語彙値リストを作成する必要があります。
     - [Numeric Data Types](../modules/numericdatatypes.md)
     - [Value Suggest](../modules/valuesuggest.md)
- リモートインストールで使用されている[リソーステンプレートをインポートする](../content/resource-template.md#import-a-resource-template)。

これらすべてのインフラが整ったら、ローカルのインストールはアイテムのインポートを始める準備が整います。

## インポートを追加する

管理者インターフェースのモジュールのランディングページで「Add an Import（インポートを追加する）」ボタンをクリックし、インポートプロセスを開始します。次に、リモートとローカルの2種類の設定を行うページが表示されます。

### リモート設定

**ルートエンドポイント（必須）**：インポートしたいインストールのAPIのエンドポイントを入力します。"ルートエンドポイント"を見つけるには、インストールへ移動し、URLの"/s/"を含む部分を"/api"に置き換えます。

例えば、このURL：

`http://your-domain-name.edu/omeka-s/s/sitename/page/home`

を 

`http://your-domain-name.edu/omeka-s/api/`

に変更します。

APIのURLをクリックすると、次のようなものが表示されるはずです：

```
{"errors":{"error":"The API request resource must be a string. Type \u0022NULL\u0022 given."}}
```

これはエラーメッセージですが、このURLがルートエンドポイントです。

**クエリ**：インポートするアイテムをフィルタリングするために「クエリ」を含めるオプションがあります。クエリを提供しなければ、モジュールはリモートインストールからすべてのアイテムをインポートします。クエリを生成する一つの方法は、サイトで詳細検索を行うことです。結果が読み込まれたら、URLの「?」の右側にある部分を選択して、クエリ文字列を取得します。

**キー識別子**と**キー資格情報**：プライベートとしてマークされたリソースをインポートしたい場合は、「キー識別子」と「キー資格情報」を提供する必要があります。これらの文字列を取得する唯一の方法は、リモートインストールにアカウントを持っているか、アカウントを持っている人に提供してもらうことです。

### ローカル設定

**インポートラベル（必須）**：インポートに識別ラベルを入力します。

**アイテムセット**：必要に応じて、インポートされたアイテムが割り当てられるアイテムセットを一つ以上選択します。

**メディアの除外**：インポートがメディアを除外するようにしたければ、この項目にチェックを入れます。チェックを入れなければ、メディアは通常通りにインポートされます。後でこの設定を変更する場合は、新しいスナップショットを取り、新しいインポートを処理する必要があります。データの継続的な自動同期の機能はありません。

**アイテムセットの除外**：インポートがパラメータ内に存在するアイテムセットを除外するようにしたければ、この項目にチェックを入れます。チェックを入れなければ、アイテムセットは通常通りにインポートされます。

**削除されたリソースを保持する**：インポート中に、以前のインポートから削除されたローカルリソースを保持したい場合は、この項目にチェックを入れます。チェックされている場合、削除されたリソースはローカルに残りますが、このインポートによって管理されなくなります。チェックされていない場合は、削除されたリソースは通常通りにローカルで削除されます。

**リモートサイトのURLを追加する**：インポートされたアイテムの一般的なソースを示したい場合は、インポートされたリソースが派生するサイトのURLを入力します。入力された場合、これはすべてのインポートされたリソースに追加され、osii:source_siteのプロパティを使用して値として保存されます。

**リモートリソースのURLを追加する**：リモートアイテムの正規URLを、osii:source_resourceのプロパティを使用して値として保存されるすべてのインポートされたアイテムに追加したい場合は、この項目にチェックを入れます。これにより、元のアイテムへの直接リンクが提供されます。

インターフェースの右上隅にある「Submit（送信）」ボタンをクリックして、設定を保存します。インポートが設定されると、将来の編集や再実行のために保存されます。

![ルートエンドポイント、クエリ、インポートラベル、アイテムセット、リモートサイ
トのURLが入力されたAdd Import設定フォームの画像](../modules/modulesfiles/osii_ConfigureImportFormWithData.png "ルートエンドポイント、クエリ、インポートラベル、アイテムセット、リモートサイトのURLが入力されたAdd Import設定フォーム")

## インポートを管理する

インポートが設定されると、ユーザーはリモートインストールのデータをローカルインストールにマッピングするオプションを提供するマッピングエリア、インポート処理のアクションオプションにアクセスできる「インポートアクション」、インポートの設定を表示する「インポートメタデータ」の3つのエリアを持つインターフェースに移動します。

インポートの初期設定では、インターフェースのメインエリアに「Prepare import is not available now.（インポートの準備は現在利用できません）」というメッセージが表示されます。

![インポートの追加が成功し、右サイドバーのImport ActionsとImport Metadataセクションが表示された結果画面](../modules/modulesfiles/osii_ImportSuccessfullyAdded.png "インポートの追加が成功し、右サイドバーのImport ActionsとImport Metadataセクションが表示された結果画面")

### スナップショットの取得

サイドバーのImport actionsセクションに進みます。「Import actions」セクションには、インポートを正常に実行し、トラブルシューティングするために必要なほとんどのアクションが含まれています。**Take snapshot（スナップショットを取る）**リンクをクリックし、確認ボタンをクリックしてリモートインストールの現在のリソースのスナップショットを取ります。これにより、リソースのデータが収集され、ローカルインストールをリモートインストールと一致させるための準備が整います。

![Take Snapshotリンクが赤枠で強調表示された右サイドバーのImport actionsセクションの画像](../modules/modulesfiles/osii_TakeS.png "Take Snapshotリンクが赤枠で強調表示された右サイドバーのImport actionsセクションの画像")

スナップショットのステータスインジケーターは[n/a]から「In progress（進行中）」に変わります。インポートには、調査する範囲に応じて時間がかかることがあります。**Refresh Status（ステータスを更新する）**リンクをクリックして進捗を確認できます。ステータスが「Error（エラー）」に変わった場合は、**View job（ジョブを見る）**をクリックしてスナップショットの処理を検査できます。

![スナップショットステータスがIn Progress（進行中）であるImport actionsセクションの画像](../modules/modulesfiles/osii_SnapshotInProgress.png "スナップショットステータスがIn Progress（進行中）であるImport actionsセクションの画像")

スナップショットを**Stop snapshot（スナップショットを止める）**したい場合があるかもしれません。スナップショットのステータスは「Stopping（停止中）」に変わります。ステータスが「Stopped（停止）」に変わるまで、**Refresh Status（ステータスを更新する）**をクリックしつづけます。

成功裏にスナップショットを取ると、ステータスは「Completed（完了）」に変わり、インターフェースのメインパネルにはスナップショットに関するかなりの量のメタデータが含まれます。これを使って、望む範囲でリモートとローカルのインストール間の差異を調整してください。

### インポートの準備

インターフェースのメインパネルにあるMappingエリアでは、インポートするデータの要素を指定するためのインターフェースがユーザーに提供されます。タブを使ったインターフェースは、リモートインストールの情報とローカルデータ構成の比較を提供します。

- **Resourcesタブ**：このビューは、リモートインストールとローカルインストールの両方にインポートの範囲内のリソースの概要を提供します。

![Resources, Data Types, Media Ingestors, Properties, and Classesのタブを持つインポート管理の概要テーブルの画像](../modules/modulesfiles/osii_ManageImportOverview.png "Resources, Data Types, Media Ingestors, Properties, and Classesのタブを持つインポート管理の概要テーブル")

- **Data typesタブ**：このビューは、リモートデータタイプとその値の数を表示します。ユーザーは、ドロップダウンメニューからローカルに存在するデータタイプ（例：literal, resource, URI, numeric:timestamp）を選択して、ローカルインストールをリモートインストールにマップします。リモートに存在するデータタイプがローカルにないことが分かった場合は、データ損失を避けるためにインストールを進める前にそれらを追加する必要があります。リモートのデータタイプがローカルのものにマップされていない場合、その値はインポートされません。

- **Templatesタブ**：このビューは、リモートリソーステンプレートとそのカウントを表示します。ユーザーは、ドロップダウンメニューからローカルで利用可能なリソーステンプレートを選択して、ローカルインストールをリモートインストールにマップします。

- **Media ingestersタブ**：このビューは、リモートメディアインジェスターのリストと、それがローカルインストールで利用可能かどうかを示します。そのインジェスターが利用可能であれば、メディアはインポートされます。

- **Propertiesタブ**：このビューは、リモートプロパティのリストとそれがローカルインストールであるかどうかを含みます。それぞれのプロパティがローカルインストールにある場合にのみ、値がインポートされます。リモートで利用可能なプロパティがローカルに存在しないことが分かった場合は、データ損失を避けるためにインストールを進める前にそれらの語彙を追加する必要があります。

![ローカルインストールに存在するプロパティと存在しないプロパティを示す赤枠で強調表示されたプロパティインベントリテーブルが含まれたインポート管理テーブルの画像](../modules/modulesfiles